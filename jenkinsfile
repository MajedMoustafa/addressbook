pipeline {
    agent any
    
    stages {
        stage('cloneProject') {
            steps {
                git 'https://github.com/MajedMoustafa/addressbook.git'
            }
        }
	
	stage('stop old containers') {
	    steps {
	    	sh 'docker ps --filter "ancestor=cep" -q | xargs docker stop'
	    }
	}
        
        stage('docker image build') {
            steps {
				echo 'docker image build'
                sh 'docker build . -t cep'
            }
        }
		stage('docker container run') {
            steps {
				echo 'run container'
                sh 'docker container run -p 8888:8080 -d cep'
            }
        }
		stage('test') {	
            steps {
				echo 'test'
                sh 'curl http://localhost:8888'
            }
        }
    }
}
